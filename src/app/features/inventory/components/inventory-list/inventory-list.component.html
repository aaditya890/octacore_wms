<div class="min-h-screen bg-gray-50 px-8 py-10">
  <div class="max-w-7xl mx-auto space-y-10">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-extrabold text-black">Inventory Management</h1>
        <p class="text-gray-600 text-sm mt-1">
          View, filter, and manage your inventory items
        </p>
      </div>
      <button *appRoleBased="['admin']" (click)="navigateToAdd()"
        class="px-5 py-2.5 bg-black text-white font-semibold rounded-md border border-black hover:bg-white hover:text-black transition-all">
        + Add Item
      </button>
    </div>

    <!-- Filters -->
    <div class="bg-white border border-gray-200 rounded-xl p-6 grid grid-cols-1 md:grid-cols-4 gap-5 items-end">
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold text-gray-800 mb-1">Search</label>
        <input type="text" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()" placeholder="Search by name or code..."
          class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-black focus:border-black" />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-800 mb-1">Category</label>
        <select [(ngModel)]="selectedCategory" (change)="onFilterChange()"
          class="w-full px-3 py-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-black focus:border-black">
          <option value="">All Categories</option>
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-800 mb-1">Status</label>
        <select [(ngModel)]="selectedStatus" (change)="onFilterChange()"
          class="w-full px-3 py-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-black focus:border-black">
          <option value="">All Status</option>
          <option *ngFor="let status of statuses" [value]="status">
            {{ status | titlecase }}
          </option>
        </select>
      </div>

      <div class="md:col-span-4 flex gap-3">
        <button (click)="onSearch()"
          class="px-5 py-2.5 bg-black text-white rounded-md font-semibold border border-black hover:bg-white hover:text-black transition-all">
          Apply
        </button>
        <button (click)="clearFilters()"
          class="px-5 py-2.5 bg-white text-black rounded-md font-semibold border border-black hover:bg-black hover:text-white transition-all">
          Clear
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-16">
      <div class="animate-spin h-10 w-10 border-4 border-black border-t-transparent rounded-full mb-4"></div>
      <p class="text-gray-600">Loading inventory...</p>
    </div>

    <!-- Empty -->
    <div *ngIf="!isLoading && filteredItems.length === 0"
      class="bg-white border border-gray-200 rounded-xl p-12 text-center">
      <p class="text-lg font-semibold text-black mb-2">No items found</p>
      <p class="text-gray-600 mb-6">Try adjusting filters or add a new item</p>
      <button *appRoleBased="['admin']" (click)="navigateToAdd()"
        class="px-5 py-2.5 bg-black text-white rounded-md font-semibold border border-black hover:bg-white hover:text-black transition-all">
        Add Item
      </button>
    </div>

    <!-- Table -->
    <div *ngIf="!isLoading && filteredItems.length > 0"
      class="bg-white border border-gray-200 rounded-xl overflow-hidden">
      <div class="overflow-x-auto scrollbar-hide" style="-ms-overflow-style: none; scrollbar-width: none;">
        <table class="min-w-full border-separate border-spacing-y-1 whitespace-nowrap">
          <thead>
            <tr class="bg-gray-100 text-gray-700 text-sm uppercase">
              <th class="px-6 py-3 text-center font-semibold">S.No</th>
              <th class="px-6 py-3 text-left font-semibold">Item</th>
              <th class="px-6 py-3 text-left font-semibold">Category</th>
              <th class="px-6 py-3 text-left font-semibold">Qty</th>
              <th class="px-6 py-3 text-left font-semibold">Unit</th>
              <th class="px-6 py-3 text-left font-semibold">Price</th>
              <th class="px-6 py-3 text-left font-semibold">Status</th>
              <th class="px-6 py-3 text-left font-semibold">Stock</th>
              <th class="px-6 py-3 text-left font-semibold">Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let item of filteredItems; let i = index"
              class="bg-white hover:bg-gray-50 border-b border-gray-100 transition">
              <td class="text-center">{{ i + 1 }}</td>
              <td (click)="openDetailDialog(item,i)"
                class="px-6 py-3 text-sm font-semibold text-black cursor-pointer hover:underline">
                {{ item.item_name }}
              </td>

              <td class="px-6 py-3 text-sm text-gray-700">{{ item.category }}</td>
              <td class="px-6 py-3 text-sm font-semibold">{{ item.quantity }}</td>
              <td class="px-6 py-3 text-sm text-gray-700">{{ item.unit }}</td>
              <td class="px-6 py-3 text-sm text-gray-700">
                â‚¹{{ item.unit_price.toFixed(2) }}
              </td>

              <!-- Status -->
              <td class="px-6 py-3">
                <span
                  class="inline-flex items-center justify-center whitespace-nowrap px-3 py-1 text-xs font-semibold rounded-full border"
                  [ngClass]="{
                    'border-green-500 text-green-700 bg-green-50': item.status === 'active',
                    'border-gray-400 text-gray-700 bg-gray-100': item.status !== 'active'
                  }">
                  {{ item.status | titlecase }}
                </span>
              </td>

              <!-- Stock -->
              <td class="px-6 py-3">
                <span
                  class="inline-flex items-center justify-center whitespace-nowrap px-3 py-1 text-xs font-semibold rounded-full border"
                  [ngClass]="{
                    'border-green-500 text-green-700 bg-green-50': getStockStatus(item) === 'In Stock',
                    'border-yellow-500 text-yellow-700 bg-yellow-50': getStockStatus(item) === 'Low Stock',
                    'border-red-500 text-red-700 bg-red-50': getStockStatus(item) === 'Out of Stock'
                  }">
                  {{ getStockStatus(item) }}
                </span>
              </td>

              <!-- Actions -->
              <td class="px-6 py-3 flex gap-2">
                <button *appRoleBased="['admin']" (click)="navigateToEdit(item.id)"
                  class="px-4 py-1.5 text-xs font-semibold border border-gray-800 rounded-md hover:bg-gray-900 hover:text-white transition-all whitespace-nowrap">
                  Edit
                </button>
                <button *appRoleBased="['admin']" (click)="deleteItem(item.id, item.item_name)"
                  class="px-4 py-1.5 text-xs font-semibold border border-red-500 text-red-600 rounded-md hover:bg-red-500 hover:text-white transition-all whitespace-nowrap">
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="px-6 py-3 text-sm text-gray-500 bg-gray-50 border-t">
        Showing {{ filteredItems.length }} item(s)
      </div>
    </div>
  </div>
</div>