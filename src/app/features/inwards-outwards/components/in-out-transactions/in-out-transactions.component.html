<div class="p-8 bg-gray-50 min-h-screen">
  <!-- HEADER -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Inwards & Outwards</h1>
      <p class="text-gray-500 mt-1">Track all inventory movement transactions</p>
    </div>

    <div class="flex gap-3">
      <button (click)="addInward()" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition">
        + Inward Entry
      </button>

      <button (click)="addOutward()" class="border border-gray-800 px-4 py-2 rounded-md hover:bg-gray-100 font-medium">
        + Outward Entry
      </button>
    </div>
  </div>

  <!-- PAGINATION ON TOP -->
  <div class="flex justify-between items-center mb-4">
    <p class="text-gray-600 text-sm font-medium">
      Showing {{ getDisplayRange() }} record(s)
    </p>

    <mat-paginator [length]="totalLength" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 20, 50,100,]"
      (page)="loadTransactions($event)" showFirstLastButtons>
    </mat-paginator>
  </div>

  <!-- FILTERS -->
  <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 mb-6 flex flex-wrap items-end gap-4">
    <div class="flex-1 min-w-[220px]">
      <label class="text-sm font-semibold text-gray-600 block mb-1">Search by Item</label>
      <input type="text" [(ngModel)]="searchTerm" placeholder="Enter item name..."
        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-black focus:outline-none" />
    </div>

    <div class="min-w-[180px]">
      <label class="text-sm font-semibold text-gray-600 block mb-1">Type</label>
      <select [(ngModel)]="filterType"
        class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-black focus:outline-none">
        <option value="all">All</option>
        <option value="inward">Inward</option>
        <option value="outward">Outward</option>
      </select>
    </div>

    <div>
      <label class="text-sm font-semibold text-gray-600 block mb-1">Date</label>
      <input type="date" [(ngModel)]="selectedDate"
        class="border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-black focus:outline-none" />
    </div>

    <div class="flex gap-2">
      <button (click)="applyFilter()" class="bg-black text-white px-5 py-2 rounded-md hover:bg-gray-800 transition">
        Apply
      </button>
      <button (click)="clearFilters()" class="border border-gray-300 px-5 py-2 rounded-md hover:bg-gray-100 transition">
        Clear
      </button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
    <div *ngIf="!loading; else loadingTpl">
      <table mat-table [dataSource]="dataSource" class="min-w-full text-sm text-gray-700">

        <!-- # -->
        <ng-container matColumnDef="sr_no">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">#</th>
          <td mat-cell *matCellDef="let t" class="p-3">{{ t.sr_no }}</td>
        </ng-container>

        <!-- Type -->
        <ng-container matColumnDef="transaction_type">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Type</th>
          <td mat-cell *matCellDef="let t" class="p-3 capitalize">
            <span [ngClass]="{
                'bg-green-100 text-green-700': t.transaction_type === 'inward',
                'bg-red-100 text-red-700': t.transaction_type === 'outward'
              }" class="px-2 py-1 text-xs font-medium rounded-full">
              {{ t.transaction_type }}
            </span>
          </td>
        </ng-container>

<!-- Item -->
<ng-container matColumnDef="item">
  <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Item</th>
  <td mat-cell *matCellDef="let t" class="p-3">
    <ng-container *ngIf="t.item_name !== '—'; else showNoteName">
      {{ t.item_name }}
    </ng-container>
    <ng-template #showNoteName>
      {{ extractItemName(t.notes) || '-' }}
    </ng-template>
  </td>
</ng-container>


        <!-- Quantity -->
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Qty</th>
          <td mat-cell *matCellDef="let t" class="p-3">{{ t.quantity }}</td>
        </ng-container>

        <!-- Unit -->
        <ng-container matColumnDef="unit">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Unit</th>
          <td mat-cell *matCellDef="let t" class="p-3">{{ t.unit }}</td>
        </ng-container>

        <!-- Unit Price -->
        <ng-container matColumnDef="unit_price">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Unit Price</th>
          <td mat-cell *matCellDef="let t" class="p-3">
            ₹{{ t.unit_price | number: '1.0-2' }}
          </td>
        </ng-container>

        <!-- Total Value -->
        <ng-container matColumnDef="total_value">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Total Value</th>
          <td mat-cell *matCellDef="let t" class="p-3">
            ₹{{ t.total_value | number: '1.0-2' }}
          </td>
        </ng-container>


        <!-- Party -->
        <ng-container matColumnDef="party_name">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Party</th>
          <td mat-cell *matCellDef="let t" class="p-3">{{ t.party_name }}</td>
        </ng-container>

        <!-- Invoice -->
        <ng-container matColumnDef="invoice_number">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Invoice/Ref</th>
          <td mat-cell *matCellDef="let t" class="p-3">{{ t.invoice_number }}</td>
        </ng-container>

        <!-- Date -->
        <ng-container matColumnDef="created_at">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold">Date & Time</th>
          <td mat-cell *matCellDef="let t" class="p-3">
            {{ t.created_at | date: 'dd MMM yyyy, hh:mm a' }}
          </td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="p-3 font-semibold text-center">Actions</th>
          <td mat-cell *matCellDef="let t" class="p-3 text-center">
            <button (click)="deleteTransaction(t)"
              class="border border-red-500 text-red-600 px-3 py-1 rounded-md hover:bg-red-100 text-sm transition">
              Delete
            </button>
          </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-100 border-b"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns" class="border-b hover:bg-gray-50 transition"></tr>
      </table>
    </div>

    <ng-template #loadingTpl>
      <div class="py-10 text-center text-gray-500 flex flex-col items-center">
        <mat-spinner diameter="40"></mat-spinner>
        <p class="mt-3">Loading transactions...</p>
      </div>
    </ng-template>
  </div>
</div>